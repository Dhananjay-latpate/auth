"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("pages/_app",{

/***/ "./src/context/AuthContext.js":
/*!************************************!*\
  !*** ./src/context/AuthContext.js ***!
  \************************************/
/***/ (function(module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"AuthProvider\": function() { return /* binding */ AuthProvider; },\n/* harmony export */   \"useAuth\": function() { return /* binding */ useAuth; }\n/* harmony export */ });\n/* harmony import */ var react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react/jsx-dev-runtime */ \"./node_modules/react/jsx-dev-runtime.js\");\n/* harmony import */ var react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"./node_modules/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var next_router__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/router */ \"./node_modules/next/router.js\");\n/* harmony import */ var next_router__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_router__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! axios */ \"./node_modules/axios/index.js\");\n/* harmony import */ var cookies_next__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! cookies-next */ \"./node_modules/cookies-next/lib/index.js\");\n/* harmony import */ var cookies_next__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(cookies_next__WEBPACK_IMPORTED_MODULE_3__);\n\nvar _s = $RefreshSig$(), _s1 = $RefreshSig$();\n\n\n\n\n// Create context\nconst AuthContext = /*#__PURE__*/ (0,react__WEBPACK_IMPORTED_MODULE_1__.createContext)(null);\n// Setup axios defaults and interceptors to handle auth\nconst setupAxiosDefaults = (token)=>{\n    if (token) {\n        axios__WEBPACK_IMPORTED_MODULE_4__[\"default\"].defaults.headers.common.Authorization = \"Bearer \".concat(token);\n    } else {\n        delete axios__WEBPACK_IMPORTED_MODULE_4__[\"default\"].defaults.headers.common.Authorization;\n    }\n};\n// AuthProvider component\nconst AuthProvider = (param)=>{\n    let { children  } = param;\n    _s();\n    const [user, setUser] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\n    const [loading, setLoading] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(true);\n    const [error, setError] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\n    const [tokenRefreshInterval, setTokenRefreshInterval] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\n    // Add a new ref to prevent multiple auth checks when navigating\n    const authCheckInProgress = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(false);\n    const hasInitialized = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(false);\n    const router = (0,next_router__WEBPACK_IMPORTED_MODULE_2__.useRouter)();\n    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{\n        const initAuth = async ()=>{\n            // Prevent multiple simultaneous auth checks\n            if (authCheckInProgress.current) return;\n            if (hasInitialized.current) return;\n            authCheckInProgress.current = true;\n            hasInitialized.current = true;\n            try {\n                // Get token from localStorage or cookie\n                const token =  true ? localStorage.getItem(\"auth_token\") || (0,cookies_next__WEBPACK_IMPORTED_MODULE_3__.getCookie)(\"token\") : 0;\n                if (token) {\n                    // Set the default authorization header for all requests\n                    setupAxiosDefaults(token);\n                }\n                await checkUserLoggedIn();\n            } finally{\n                authCheckInProgress.current = false;\n            }\n        };\n        initAuth();\n        // Clean up refresh interval on unmount\n        return ()=>{\n            if (tokenRefreshInterval) {\n                clearInterval(tokenRefreshInterval);\n            }\n        };\n    }, []);\n    // Setup a token refresh mechanism\n    const setupTokenRefresh = ()=>{\n        // Clear any existing interval\n        if (tokenRefreshInterval) {\n            clearInterval(tokenRefreshInterval);\n        }\n        // Refresh token every 55 minutes (just before standard 1 hour expiration)\n        const interval = setInterval(async ()=>{\n            try {\n                const token = (0,cookies_next__WEBPACK_IMPORTED_MODULE_3__.getCookie)(\"token\");\n                if (token) {\n                    const refreshRes = await axios__WEBPACK_IMPORTED_MODULE_4__[\"default\"].get(\"\".concat(\"http://localhost:5000\", \"/api/v1/auth/refresh-token\"), {\n                        headers: {\n                            Authorization: \"Bearer \".concat(token)\n                        }\n                    });\n                    if (refreshRes.data.success) {\n                        (0,cookies_next__WEBPACK_IMPORTED_MODULE_3__.setCookie)(\"token\", refreshRes.data.token);\n                    }\n                }\n            } catch (error) {\n                console.error(\"Token refresh failed\", error);\n                // If refresh fails, user may need to re-authenticate\n                logout();\n            }\n        }, 55 * 60 * 1000); // 55 minutes\n        setTokenRefreshInterval(interval);\n    };\n    // Register user\n    const register = async (userData)=>{\n        try {\n            const res = await axios__WEBPACK_IMPORTED_MODULE_4__[\"default\"].post(\"\".concat(\"http://localhost:5000\", \"/api/v1/auth/register\"), userData, {\n                withCredentials: true\n            });\n            if (res.data.success) {\n                (0,cookies_next__WEBPACK_IMPORTED_MODULE_3__.setCookie)(\"token\", res.data.token);\n                await checkUserLoggedIn(); // Fetch user data\n                setupTokenRefresh();\n                router.push(\"/dashboard\");\n            }\n        } catch (error) {\n            var _error_response, _error_response_data;\n            setError(((_error_response = error.response) === null || _error_response === void 0 ? void 0 : (_error_response_data = _error_response.data) === null || _error_response_data === void 0 ? void 0 : _error_response_data.error) || \"An error occurred during registration\");\n            setTimeout(()=>setError(null), 5000);\n        }\n    };\n    // Login user\n    const login = async (param)=>{\n        let { email , password  } = param;\n        try {\n            console.log(\"Attempting login with:\", {\n                email\n            });\n            // Ensure no redirect loop by clearing all tokens first\n            (0,cookies_next__WEBPACK_IMPORTED_MODULE_3__.deleteCookie)(\"token\", {\n                path: \"/\"\n            });\n            localStorage.removeItem(\"auth_token\");\n            localStorage.removeItem(\"user_data\");\n            localStorage.removeItem(\"isLoggingOut\");\n            delete axios__WEBPACK_IMPORTED_MODULE_4__[\"default\"].defaults.headers.common.Authorization;\n            const res = await axios__WEBPACK_IMPORTED_MODULE_4__[\"default\"].post(\"\".concat(\"http://localhost:5000\", \"/api/v1/auth/login\"), {\n                email,\n                password\n            }, {\n                withCredentials: true\n            });\n            console.log(\"Login response:\", res.data);\n            // Check if 2FA is required\n            if (res.data.requireTwoFactor) {\n                router.push({\n                    pathname: \"/login/verify-2fa\",\n                    query: {\n                        email\n                    }\n                });\n                return;\n            }\n            if (res.data.success && res.data.token) {\n                // Ensure token is properly formatted and stored\n                const token = res.data.token.trim();\n                // Store token in localStorage for persistence\n                localStorage.setItem(\"auth_token\", token);\n                // Set cookie with proper options\n                (0,cookies_next__WEBPACK_IMPORTED_MODULE_3__.setCookie)(\"token\", token, {\n                    maxAge: 30 * 24 * 60 * 60,\n                    path: \"/\"\n                });\n                // Set the default authorization header\n                setupAxiosDefaults(token);\n                console.log(\"Token set in cookie and localStorage\");\n                // Store basic user data immediately from the login response\n                if (res.data.user) {\n                    setUser(res.data.user);\n                    localStorage.setItem(\"user_data\", JSON.stringify(res.data.user));\n                }\n                // Also fetch full user data\n                await checkUserLoggedIn();\n                setupTokenRefresh();\n                // Use direct navigation to dashboard to avoid any middleware issues\n                window.location.href = \"/dashboard\";\n                return res.data;\n            }\n            return res.data;\n        } catch (error) {\n            var _error_response, _error_response_data;\n            console.error(\"Login error:\", error);\n            if (error.response) {\n                console.error(\"Error response data:\", error.response.data);\n            }\n            setError(((_error_response = error.response) === null || _error_response === void 0 ? void 0 : (_error_response_data = _error_response.data) === null || _error_response_data === void 0 ? void 0 : _error_response_data.error) || \"Invalid credentials\");\n            setTimeout(()=>setError(null), 5000);\n            throw error;\n        }\n    };\n    // Logout user\n    const logout = async ()=>{\n        try {\n            // Set a flag to prevent multiple logout attempts\n            const isLoggingOut = localStorage.getItem(\"isLoggingOut\");\n            if (isLoggingOut === \"true\") {\n                console.log(\"Logout already in progress\");\n                return;\n            }\n            localStorage.setItem(\"isLoggingOut\", \"true\");\n            console.log(\"Started logout process\");\n            // Get token for API call\n            const token = (0,cookies_next__WEBPACK_IMPORTED_MODULE_3__.getCookie)(\"token\") || localStorage.getItem(\"auth_token\");\n            // First clear all state and tokens to prevent redirect loops\n            setUser(null);\n            // Clear all authentication tokens with proper path\n            (0,cookies_next__WEBPACK_IMPORTED_MODULE_3__.deleteCookie)(\"token\", {\n                path: \"/\"\n            });\n            localStorage.removeItem(\"auth_token\");\n            localStorage.removeItem(\"user_data\");\n            delete axios__WEBPACK_IMPORTED_MODULE_4__[\"default\"].defaults.headers.common.Authorization;\n            // Clear token refresh interval\n            if (tokenRefreshInterval) {\n                clearInterval(tokenRefreshInterval);\n                setTokenRefreshInterval(null);\n            }\n            // Call the API to logout - but don't wait for it\n            if (token) {\n                try {\n                    // Use a separate fetch to avoid complications with axios\n                    fetch(\"\".concat(\"http://localhost:5000\", \"/api/v1/auth/logout\"), {\n                        method: \"GET\",\n                        headers: {\n                            Authorization: \"Bearer \".concat(token)\n                        }\n                    }).then(()=>{\n                        console.log(\"Successful API logout call\");\n                    }).catch((e)=>{\n                        console.log(\"Logout API error (non-critical):\", e);\n                    });\n                } catch (apiError) {\n                    console.log(\"Logout API call error (non-critical):\", apiError);\n                }\n            }\n        } catch (error) {\n            console.error(\"Logout process error:\", error);\n        } finally{\n            // Add a timestamp to ensure the login page recognizes this as a fresh logout\n            const timestamp = Date.now();\n            // Clear the logging out flag before redirecting\n            localStorage.removeItem(\"isLoggingOut\");\n            // Force hard redirect to login page with logged_out flag and timestamp\n            // Use a full URL including origin to ensure clean navigation\n            console.log(\"Redirecting to login page with logged_out=true\");\n            const loginUrl =  true ? \"\".concat(window.location.origin, \"/login?logged_out=true&t=\").concat(timestamp) : 0;\n            // Use window.location.replace for a cleaner browser history\n            if (true) {\n                window.location.replace(loginUrl);\n            }\n        }\n    };\n    // Check if user is logged in\n    const checkUserLoggedIn = async ()=>{\n        // Prevent concurrent auth checks\n        if (authCheckInProgress.current) {\n            return user;\n        }\n        authCheckInProgress.current = true;\n        try {\n            // Try to get token from multiple sources\n            const cookieToken = (0,cookies_next__WEBPACK_IMPORTED_MODULE_3__.getCookie)(\"token\");\n            const localToken =  true ? localStorage.getItem(\"auth_token\") : 0;\n            let token = cookieToken || localToken;\n            console.log(\"Checking auth with token:\", token ? \"Token exists\" : \"No token\");\n            if (!token) {\n                console.log(\"No token found in cookie or localStorage\");\n                setUser(null);\n                localStorage.removeItem(\"user_data\");\n                return null;\n            }\n            // Ensure token is properly formatted (no extra whitespace)\n            token = token.trim();\n            // Set token in axios defaults\n            setupAxiosDefaults(token);\n            // If we have a token in localStorage but not in cookie, restore it\n            if (!cookieToken && localToken) {\n                (0,cookies_next__WEBPACK_IMPORTED_MODULE_3__.setCookie)(\"token\", token, {\n                    maxAge: 30 * 24 * 60 * 60,\n                    path: \"/\"\n                });\n            }\n            // Try to get cached user data first\n            const cachedUser =  true ? localStorage.getItem(\"user_data\") : 0;\n            if (cachedUser) {\n                try {\n                    const userData = JSON.parse(cachedUser);\n                    setUser(userData);\n                // We'll still fetch fresh data below\n                } catch (e) {\n                    console.error(\"Error parsing cached user data\", e);\n                    localStorage.removeItem(\"user_data\");\n                }\n            }\n            // Fetch fresh user data from API\n            console.log(\"Fetching user data from API using token\");\n            const res = await axios__WEBPACK_IMPORTED_MODULE_4__[\"default\"].get(\"\".concat(\"http://localhost:5000\", \"/api/v1/auth/me\"));\n            if (res.data.success) {\n                console.log(\"Setting user data:\", res.data.data);\n                setUser(res.data.data);\n                localStorage.setItem(\"user_data\", JSON.stringify(res.data.data));\n                setupTokenRefresh();\n                return res.data.data;\n            }\n        } catch (error) {\n            console.error(\"Error fetching user:\", error);\n            // Handle unauthorized errors\n            if (error.response && error.response.status === 401) {\n                console.log(\"Unauthorized access - clearing tokens\");\n                setUser(null);\n                (0,cookies_next__WEBPACK_IMPORTED_MODULE_3__.deleteCookie)(\"token\", {\n                    path: \"/\"\n                });\n                localStorage.removeItem(\"auth_token\");\n                localStorage.removeItem(\"user_data\");\n                delete axios__WEBPACK_IMPORTED_MODULE_4__[\"default\"].defaults.headers.common.Authorization;\n            }\n        } finally{\n            setLoading(false);\n            authCheckInProgress.current = false;\n        }\n        return null;\n    };\n    // Check if user has specified permission\n    const hasPermission = (permission)=>{\n        if (!user) return false;\n        // Admins and superadmins have all permissions\n        if ([\n            \"admin\",\n            \"superadmin\"\n        ].includes(user.role)) {\n            return true;\n        }\n        return user.permissions && user.permissions.includes(permission);\n    };\n    return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(AuthContext.Provider, {\n        value: {\n            user,\n            loading,\n            error,\n            register,\n            login,\n            logout,\n            hasPermission,\n            checkUserLoggedIn\n        },\n        children: children\n    }, void 0, false, {\n        fileName: \"/home/redlight/auth/frontend/src/context/AuthContext.js\",\n        lineNumber: 388,\n        columnNumber: 5\n    }, undefined);\n};\n_s(AuthProvider, \"+T65rbkVQ6h7vJX9RNK1ZQ5y83I=\", false, function() {\n    return [\n        next_router__WEBPACK_IMPORTED_MODULE_2__.useRouter\n    ];\n});\n_c = AuthProvider;\n// Export the useAuth hook\nconst useAuth = ()=>{\n    _s1();\n    const context = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(AuthContext);\n    if (context === undefined || context === null) {\n        throw new Error(\"useAuth must be used within an AuthProvider\");\n    }\n    return context;\n};\n_s1(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevExports = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevExports) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports on update so we can compare the boundary\n                // signatures.\n                module.hot.dispose(function (data) {\n                    data.prevExports = currentExports;\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevExports !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevExports, currentExports)) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevExports !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFBSUUsTUFBTSwrQ0FBK0M7SUFDakUsQ0FBQztJQUNELE9BQU9GO0FBQ1QsRUFBRTtJQU5XRCIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9zcmMvY29udGV4dC9BdXRoQ29udGV4dC5qcz80YmE2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNvbnRleHQsIHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNvbnRleHQsIHVzZVJlZiB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSBcIm5leHQvcm91dGVyXCI7XG5pbXBvcnQgYXhpb3MgZnJvbSBcImF4aW9zXCI7XG5pbXBvcnQgeyBzZXRDb29raWUsIGdldENvb2tpZSwgZGVsZXRlQ29va2llIH0gZnJvbSBcImNvb2tpZXMtbmV4dFwiO1xuXG4vLyBDcmVhdGUgY29udGV4dFxuY29uc3QgQXV0aENvbnRleHQgPSBjcmVhdGVDb250ZXh0KG51bGwpO1xuXG4vLyBTZXR1cCBheGlvcyBkZWZhdWx0cyBhbmQgaW50ZXJjZXB0b3JzIHRvIGhhbmRsZSBhdXRoXG5jb25zdCBzZXR1cEF4aW9zRGVmYXVsdHMgPSAodG9rZW4pID0+IHtcbiAgaWYgKHRva2VuKSB7XG4gICAgYXhpb3MuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bXCJBdXRob3JpemF0aW9uXCJdID0gYEJlYXJlciAke3Rva2VufWA7XG4gIH0gZWxzZSB7XG4gICAgZGVsZXRlIGF4aW9zLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uW1wiQXV0aG9yaXphdGlvblwiXTtcbiAgfVxufTtcblxuLy8gQXV0aFByb3ZpZGVyIGNvbXBvbmVudFxuZXhwb3J0IGNvbnN0IEF1dGhQcm92aWRlciA9ICh7IGNoaWxkcmVuIH0pID0+IHtcbiAgY29uc3QgW3VzZXIsIHNldFVzZXJdID0gdXNlU3RhdGUobnVsbCk7XG4gIGNvbnN0IFtsb2FkaW5nLCBzZXRMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpO1xuICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlKG51bGwpO1xuICBjb25zdCBbdG9rZW5SZWZyZXNoSW50ZXJ2YWwsIHNldFRva2VuUmVmcmVzaEludGVydmFsXSA9IHVzZVN0YXRlKG51bGwpO1xuICAvLyBBZGQgYSBuZXcgcmVmIHRvIHByZXZlbnQgbXVsdGlwbGUgYXV0aCBjaGVja3Mgd2hlbiBuYXZpZ2F0aW5nXG4gIGNvbnN0IGF1dGhDaGVja0luUHJvZ3Jlc3MgPSB1c2VSZWYoZmFsc2UpO1xuICBjb25zdCBoYXNJbml0aWFsaXplZCA9IHVzZVJlZihmYWxzZSk7XG5cbiAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKCk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBpbml0QXV0aCA9IGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFByZXZlbnQgbXVsdGlwbGUgc2ltdWx0YW5lb3VzIGF1dGggY2hlY2tzXG4gICAgICBpZiAoYXV0aENoZWNrSW5Qcm9ncmVzcy5jdXJyZW50KSByZXR1cm47XG4gICAgICBpZiAoaGFzSW5pdGlhbGl6ZWQuY3VycmVudCkgcmV0dXJuO1xuXG4gICAgICBhdXRoQ2hlY2tJblByb2dyZXNzLmN1cnJlbnQgPSB0cnVlO1xuICAgICAgaGFzSW5pdGlhbGl6ZWQuY3VycmVudCA9IHRydWU7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEdldCB0b2tlbiBmcm9tIGxvY2FsU3RvcmFnZSBvciBjb29raWVcbiAgICAgICAgY29uc3QgdG9rZW4gPVxuICAgICAgICAgIHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCJcbiAgICAgICAgICAgID8gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJhdXRoX3Rva2VuXCIpIHx8IGdldENvb2tpZShcInRva2VuXCIpXG4gICAgICAgICAgICA6IG51bGw7XG5cbiAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgLy8gU2V0IHRoZSBkZWZhdWx0IGF1dGhvcml6YXRpb24gaGVhZGVyIGZvciBhbGwgcmVxdWVzdHNcbiAgICAgICAgICBzZXR1cEF4aW9zRGVmYXVsdHModG9rZW4pO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgY2hlY2tVc2VyTG9nZ2VkSW4oKTtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIGF1dGhDaGVja0luUHJvZ3Jlc3MuY3VycmVudCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpbml0QXV0aCgpO1xuXG4gICAgLy8gQ2xlYW4gdXAgcmVmcmVzaCBpbnRlcnZhbCBvbiB1bm1vdW50XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGlmICh0b2tlblJlZnJlc2hJbnRlcnZhbCkge1xuICAgICAgICBjbGVhckludGVydmFsKHRva2VuUmVmcmVzaEludGVydmFsKTtcbiAgICAgIH1cbiAgICB9O1xuICB9LCBbXSk7XG5cbiAgLy8gU2V0dXAgYSB0b2tlbiByZWZyZXNoIG1lY2hhbmlzbVxuICBjb25zdCBzZXR1cFRva2VuUmVmcmVzaCA9ICgpID0+IHtcbiAgICAvLyBDbGVhciBhbnkgZXhpc3RpbmcgaW50ZXJ2YWxcbiAgICBpZiAodG9rZW5SZWZyZXNoSW50ZXJ2YWwpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodG9rZW5SZWZyZXNoSW50ZXJ2YWwpO1xuICAgIH1cblxuICAgIC8vIFJlZnJlc2ggdG9rZW4gZXZlcnkgNTUgbWludXRlcyAoanVzdCBiZWZvcmUgc3RhbmRhcmQgMSBob3VyIGV4cGlyYXRpb24pXG4gICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB0b2tlbiA9IGdldENvb2tpZShcInRva2VuXCIpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICBjb25zdCByZWZyZXNoUmVzID0gYXdhaXQgYXhpb3MuZ2V0KFxuICAgICAgICAgICAgYCR7cHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBJX1VSTH0vYXBpL3YxL2F1dGgvcmVmcmVzaC10b2tlbmAsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKHJlZnJlc2hSZXMuZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICBzZXRDb29raWUoXCJ0b2tlblwiLCByZWZyZXNoUmVzLmRhdGEudG9rZW4pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlRva2VuIHJlZnJlc2ggZmFpbGVkXCIsIGVycm9yKTtcbiAgICAgICAgLy8gSWYgcmVmcmVzaCBmYWlscywgdXNlciBtYXkgbmVlZCB0byByZS1hdXRoZW50aWNhdGVcbiAgICAgICAgbG9nb3V0KCk7XG4gICAgICB9XG4gICAgfSwgNTUgKiA2MCAqIDEwMDApOyAvLyA1NSBtaW51dGVzXG5cbiAgICBzZXRUb2tlblJlZnJlc2hJbnRlcnZhbChpbnRlcnZhbCk7XG4gIH07XG5cbiAgLy8gUmVnaXN0ZXIgdXNlclxuICBjb25zdCByZWdpc3RlciA9IGFzeW5jICh1c2VyRGF0YSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBheGlvcy5wb3N0KFxuICAgICAgICBgJHtwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUElfVVJMfS9hcGkvdjEvYXV0aC9yZWdpc3RlcmAsXG4gICAgICAgIHVzZXJEYXRhLFxuICAgICAgICB7XG4gICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0cnVlLFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBpZiAocmVzLmRhdGEuc3VjY2Vzcykge1xuICAgICAgICBzZXRDb29raWUoXCJ0b2tlblwiLCByZXMuZGF0YS50b2tlbik7XG4gICAgICAgIGF3YWl0IGNoZWNrVXNlckxvZ2dlZEluKCk7IC8vIEZldGNoIHVzZXIgZGF0YVxuICAgICAgICBzZXR1cFRva2VuUmVmcmVzaCgpO1xuICAgICAgICByb3V0ZXIucHVzaChcIi9kYXNoYm9hcmRcIik7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHNldEVycm9yKFxuICAgICAgICBlcnJvci5yZXNwb25zZT8uZGF0YT8uZXJyb3IgfHwgXCJBbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgcmVnaXN0cmF0aW9uXCJcbiAgICAgICk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHNldEVycm9yKG51bGwpLCA1MDAwKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gTG9naW4gdXNlclxuICBjb25zdCBsb2dpbiA9IGFzeW5jICh7IGVtYWlsLCBwYXNzd29yZCB9KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKFwiQXR0ZW1wdGluZyBsb2dpbiB3aXRoOlwiLCB7IGVtYWlsIH0pO1xuXG4gICAgICAvLyBFbnN1cmUgbm8gcmVkaXJlY3QgbG9vcCBieSBjbGVhcmluZyBhbGwgdG9rZW5zIGZpcnN0XG4gICAgICBkZWxldGVDb29raWUoXCJ0b2tlblwiLCB7IHBhdGg6IFwiL1wiIH0pO1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJhdXRoX3Rva2VuXCIpO1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJ1c2VyX2RhdGFcIik7XG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImlzTG9nZ2luZ091dFwiKTtcbiAgICAgIGRlbGV0ZSBheGlvcy5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vbltcIkF1dGhvcml6YXRpb25cIl07XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGF4aW9zLnBvc3QoXG4gICAgICAgIGAke3Byb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQSV9VUkx9L2FwaS92MS9hdXRoL2xvZ2luYCxcbiAgICAgICAge1xuICAgICAgICAgIGVtYWlsLFxuICAgICAgICAgIHBhc3N3b3JkLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0cnVlLFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBjb25zb2xlLmxvZyhcIkxvZ2luIHJlc3BvbnNlOlwiLCByZXMuZGF0YSk7XG5cbiAgICAgIC8vIENoZWNrIGlmIDJGQSBpcyByZXF1aXJlZFxuICAgICAgaWYgKHJlcy5kYXRhLnJlcXVpcmVUd29GYWN0b3IpIHtcbiAgICAgICAgcm91dGVyLnB1c2goe1xuICAgICAgICAgIHBhdGhuYW1lOiBcIi9sb2dpbi92ZXJpZnktMmZhXCIsXG4gICAgICAgICAgcXVlcnk6IHsgZW1haWwgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlcy5kYXRhLnN1Y2Nlc3MgJiYgcmVzLmRhdGEudG9rZW4pIHtcbiAgICAgICAgLy8gRW5zdXJlIHRva2VuIGlzIHByb3Blcmx5IGZvcm1hdHRlZCBhbmQgc3RvcmVkXG4gICAgICAgIGNvbnN0IHRva2VuID0gcmVzLmRhdGEudG9rZW4udHJpbSgpO1xuXG4gICAgICAgIC8vIFN0b3JlIHRva2VuIGluIGxvY2FsU3RvcmFnZSBmb3IgcGVyc2lzdGVuY2VcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJhdXRoX3Rva2VuXCIsIHRva2VuKTtcblxuICAgICAgICAvLyBTZXQgY29va2llIHdpdGggcHJvcGVyIG9wdGlvbnNcbiAgICAgICAgc2V0Q29va2llKFwidG9rZW5cIiwgdG9rZW4sIHtcbiAgICAgICAgICBtYXhBZ2U6IDMwICogMjQgKiA2MCAqIDYwLCAvLyAzMCBkYXlzXG4gICAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNldCB0aGUgZGVmYXVsdCBhdXRob3JpemF0aW9uIGhlYWRlclxuICAgICAgICBzZXR1cEF4aW9zRGVmYXVsdHModG9rZW4pO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKFwiVG9rZW4gc2V0IGluIGNvb2tpZSBhbmQgbG9jYWxTdG9yYWdlXCIpO1xuXG4gICAgICAgIC8vIFN0b3JlIGJhc2ljIHVzZXIgZGF0YSBpbW1lZGlhdGVseSBmcm9tIHRoZSBsb2dpbiByZXNwb25zZVxuICAgICAgICBpZiAocmVzLmRhdGEudXNlcikge1xuICAgICAgICAgIHNldFVzZXIocmVzLmRhdGEudXNlcik7XG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ1c2VyX2RhdGFcIiwgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEudXNlcikpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWxzbyBmZXRjaCBmdWxsIHVzZXIgZGF0YVxuICAgICAgICBhd2FpdCBjaGVja1VzZXJMb2dnZWRJbigpO1xuICAgICAgICBzZXR1cFRva2VuUmVmcmVzaCgpO1xuXG4gICAgICAgIC8vIFVzZSBkaXJlY3QgbmF2aWdhdGlvbiB0byBkYXNoYm9hcmQgdG8gYXZvaWQgYW55IG1pZGRsZXdhcmUgaXNzdWVzXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvZGFzaGJvYXJkXCI7XG4gICAgICAgIHJldHVybiByZXMuZGF0YTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlcy5kYXRhO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiTG9naW4gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIGlmIChlcnJvci5yZXNwb25zZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVzcG9uc2UgZGF0YTpcIiwgZXJyb3IucmVzcG9uc2UuZGF0YSk7XG4gICAgICB9XG4gICAgICBzZXRFcnJvcihlcnJvci5yZXNwb25zZT8uZGF0YT8uZXJyb3IgfHwgXCJJbnZhbGlkIGNyZWRlbnRpYWxzXCIpO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiBzZXRFcnJvcihudWxsKSwgNTAwMCk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH07XG5cbiAgLy8gTG9nb3V0IHVzZXJcbiAgY29uc3QgbG9nb3V0ID0gYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBTZXQgYSBmbGFnIHRvIHByZXZlbnQgbXVsdGlwbGUgbG9nb3V0IGF0dGVtcHRzXG4gICAgICBjb25zdCBpc0xvZ2dpbmdPdXQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImlzTG9nZ2luZ091dFwiKTtcbiAgICAgIGlmIChpc0xvZ2dpbmdPdXQgPT09IFwidHJ1ZVwiKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTG9nb3V0IGFscmVhZHkgaW4gcHJvZ3Jlc3NcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJpc0xvZ2dpbmdPdXRcIiwgXCJ0cnVlXCIpO1xuICAgICAgY29uc29sZS5sb2coXCJTdGFydGVkIGxvZ291dCBwcm9jZXNzXCIpO1xuXG4gICAgICAvLyBHZXQgdG9rZW4gZm9yIEFQSSBjYWxsXG4gICAgICBjb25zdCB0b2tlbiA9IGdldENvb2tpZShcInRva2VuXCIpIHx8IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiYXV0aF90b2tlblwiKTtcblxuICAgICAgLy8gRmlyc3QgY2xlYXIgYWxsIHN0YXRlIGFuZCB0b2tlbnMgdG8gcHJldmVudCByZWRpcmVjdCBsb29wc1xuICAgICAgc2V0VXNlcihudWxsKTtcblxuICAgICAgLy8gQ2xlYXIgYWxsIGF1dGhlbnRpY2F0aW9uIHRva2VucyB3aXRoIHByb3BlciBwYXRoXG4gICAgICBkZWxldGVDb29raWUoXCJ0b2tlblwiLCB7IHBhdGg6IFwiL1wiIH0pO1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJhdXRoX3Rva2VuXCIpO1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJ1c2VyX2RhdGFcIik7XG4gICAgICBkZWxldGUgYXhpb3MuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bXCJBdXRob3JpemF0aW9uXCJdO1xuXG4gICAgICAvLyBDbGVhciB0b2tlbiByZWZyZXNoIGludGVydmFsXG4gICAgICBpZiAodG9rZW5SZWZyZXNoSW50ZXJ2YWwpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0b2tlblJlZnJlc2hJbnRlcnZhbCk7XG4gICAgICAgIHNldFRva2VuUmVmcmVzaEludGVydmFsKG51bGwpO1xuICAgICAgfVxuXG4gICAgICAvLyBDYWxsIHRoZSBBUEkgdG8gbG9nb3V0IC0gYnV0IGRvbid0IHdhaXQgZm9yIGl0XG4gICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBVc2UgYSBzZXBhcmF0ZSBmZXRjaCB0byBhdm9pZCBjb21wbGljYXRpb25zIHdpdGggYXhpb3NcbiAgICAgICAgICBmZXRjaChgJHtwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUElfVVJMfS9hcGkvdjEvYXV0aC9sb2dvdXRgLCB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlN1Y2Nlc3NmdWwgQVBJIGxvZ291dCBjYWxsXCIpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkxvZ291dCBBUEkgZXJyb3IgKG5vbi1jcml0aWNhbCk6XCIsIGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGFwaUVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJMb2dvdXQgQVBJIGNhbGwgZXJyb3IgKG5vbi1jcml0aWNhbCk6XCIsIGFwaUVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiTG9nb3V0IHByb2Nlc3MgZXJyb3I6XCIsIGVycm9yKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgLy8gQWRkIGEgdGltZXN0YW1wIHRvIGVuc3VyZSB0aGUgbG9naW4gcGFnZSByZWNvZ25pemVzIHRoaXMgYXMgYSBmcmVzaCBsb2dvdXRcbiAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG5cbiAgICAgIC8vIENsZWFyIHRoZSBsb2dnaW5nIG91dCBmbGFnIGJlZm9yZSByZWRpcmVjdGluZ1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJpc0xvZ2dpbmdPdXRcIik7XG5cbiAgICAgIC8vIEZvcmNlIGhhcmQgcmVkaXJlY3QgdG8gbG9naW4gcGFnZSB3aXRoIGxvZ2dlZF9vdXQgZmxhZyBhbmQgdGltZXN0YW1wXG4gICAgICAvLyBVc2UgYSBmdWxsIFVSTCBpbmNsdWRpbmcgb3JpZ2luIHRvIGVuc3VyZSBjbGVhbiBuYXZpZ2F0aW9uXG4gICAgICBjb25zb2xlLmxvZyhcIlJlZGlyZWN0aW5nIHRvIGxvZ2luIHBhZ2Ugd2l0aCBsb2dnZWRfb3V0PXRydWVcIik7XG4gICAgICBjb25zdCBsb2dpblVybCA9IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgXG4gICAgICAgID8gYCR7d2luZG93LmxvY2F0aW9uLm9yaWdpbn0vbG9naW4/bG9nZ2VkX291dD10cnVlJnQ9JHt0aW1lc3RhbXB9YFxuICAgICAgICA6IGAvbG9naW4/bG9nZ2VkX291dD10cnVlJnQ9JHt0aW1lc3RhbXB9YDtcbiAgICAgICAgXG4gICAgICAvLyBVc2Ugd2luZG93LmxvY2F0aW9uLnJlcGxhY2UgZm9yIGEgY2xlYW5lciBicm93c2VyIGhpc3RvcnlcbiAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKGxvZ2luVXJsKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLy8gQ2hlY2sgaWYgdXNlciBpcyBsb2dnZWQgaW5cbiAgY29uc3QgY2hlY2tVc2VyTG9nZ2VkSW4gPSBhc3luYyAoKSA9PiB7XG4gICAgLy8gUHJldmVudCBjb25jdXJyZW50IGF1dGggY2hlY2tzXG4gICAgaWYgKGF1dGhDaGVja0luUHJvZ3Jlc3MuY3VycmVudCkge1xuICAgICAgcmV0dXJuIHVzZXI7XG4gICAgfVxuXG4gICAgYXV0aENoZWNrSW5Qcm9ncmVzcy5jdXJyZW50ID0gdHJ1ZTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBUcnkgdG8gZ2V0IHRva2VuIGZyb20gbXVsdGlwbGUgc291cmNlc1xuICAgICAgY29uc3QgY29va2llVG9rZW4gPSBnZXRDb29raWUoXCJ0b2tlblwiKTtcbiAgICAgIGNvbnN0IGxvY2FsVG9rZW4gPVxuICAgICAgICB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiXG4gICAgICAgICAgPyBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImF1dGhfdG9rZW5cIilcbiAgICAgICAgICA6IG51bGw7XG4gICAgICBsZXQgdG9rZW4gPSBjb29raWVUb2tlbiB8fCBsb2NhbFRva2VuO1xuXG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgXCJDaGVja2luZyBhdXRoIHdpdGggdG9rZW46XCIsXG4gICAgICAgIHRva2VuID8gXCJUb2tlbiBleGlzdHNcIiA6IFwiTm8gdG9rZW5cIlxuICAgICAgKTtcblxuICAgICAgaWYgKCF0b2tlbikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIk5vIHRva2VuIGZvdW5kIGluIGNvb2tpZSBvciBsb2NhbFN0b3JhZ2VcIik7XG4gICAgICAgIHNldFVzZXIobnVsbCk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwidXNlcl9kYXRhXCIpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gRW5zdXJlIHRva2VuIGlzIHByb3Blcmx5IGZvcm1hdHRlZCAobm8gZXh0cmEgd2hpdGVzcGFjZSlcbiAgICAgIHRva2VuID0gdG9rZW4udHJpbSgpO1xuXG4gICAgICAvLyBTZXQgdG9rZW4gaW4gYXhpb3MgZGVmYXVsdHNcbiAgICAgIHNldHVwQXhpb3NEZWZhdWx0cyh0b2tlbik7XG5cbiAgICAgIC8vIElmIHdlIGhhdmUgYSB0b2tlbiBpbiBsb2NhbFN0b3JhZ2UgYnV0IG5vdCBpbiBjb29raWUsIHJlc3RvcmUgaXRcbiAgICAgIGlmICghY29va2llVG9rZW4gJiYgbG9jYWxUb2tlbikge1xuICAgICAgICBzZXRDb29raWUoXCJ0b2tlblwiLCB0b2tlbiwge1xuICAgICAgICAgIG1heEFnZTogMzAgKiAyNCAqIDYwICogNjAsIC8vIDMwIGRheXNcbiAgICAgICAgICBwYXRoOiBcIi9cIixcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFRyeSB0byBnZXQgY2FjaGVkIHVzZXIgZGF0YSBmaXJzdFxuICAgICAgY29uc3QgY2FjaGVkVXNlciA9XG4gICAgICAgIHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCJcbiAgICAgICAgICA/IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidXNlcl9kYXRhXCIpXG4gICAgICAgICAgOiBudWxsO1xuICAgICAgaWYgKGNhY2hlZFVzZXIpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB1c2VyRGF0YSA9IEpTT04ucGFyc2UoY2FjaGVkVXNlcik7XG4gICAgICAgICAgc2V0VXNlcih1c2VyRGF0YSk7XG4gICAgICAgICAgLy8gV2UnbGwgc3RpbGwgZmV0Y2ggZnJlc2ggZGF0YSBiZWxvd1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHBhcnNpbmcgY2FjaGVkIHVzZXIgZGF0YVwiLCBlKTtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcInVzZXJfZGF0YVwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBGZXRjaCBmcmVzaCB1c2VyIGRhdGEgZnJvbSBBUElcbiAgICAgIGNvbnNvbGUubG9nKGBGZXRjaGluZyB1c2VyIGRhdGEgZnJvbSBBUEkgdXNpbmcgdG9rZW5gKTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgYXhpb3MuZ2V0KFxuICAgICAgICBgJHtwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUElfVVJMfS9hcGkvdjEvYXV0aC9tZWBcbiAgICAgICAgLy8gQXV0aG9yaXphdGlvbiBoZWFkZXIgaXMgbm93IHNldCBieSBkZWZhdWx0XG4gICAgICApO1xuXG4gICAgICBpZiAocmVzLmRhdGEuc3VjY2Vzcykge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlNldHRpbmcgdXNlciBkYXRhOlwiLCByZXMuZGF0YS5kYXRhKTtcbiAgICAgICAgc2V0VXNlcihyZXMuZGF0YS5kYXRhKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ1c2VyX2RhdGFcIiwgSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEuZGF0YSkpO1xuICAgICAgICBzZXR1cFRva2VuUmVmcmVzaCgpO1xuICAgICAgICByZXR1cm4gcmVzLmRhdGEuZGF0YTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHVzZXI6XCIsIGVycm9yKTtcblxuICAgICAgLy8gSGFuZGxlIHVuYXV0aG9yaXplZCBlcnJvcnNcbiAgICAgIGlmIChlcnJvci5yZXNwb25zZSAmJiBlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlVuYXV0aG9yaXplZCBhY2Nlc3MgLSBjbGVhcmluZyB0b2tlbnNcIik7XG4gICAgICAgIHNldFVzZXIobnVsbCk7XG4gICAgICAgIGRlbGV0ZUNvb2tpZShcInRva2VuXCIsIHsgcGF0aDogXCIvXCIgfSk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiYXV0aF90b2tlblwiKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJ1c2VyX2RhdGFcIik7XG4gICAgICAgIGRlbGV0ZSBheGlvcy5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vbltcIkF1dGhvcml6YXRpb25cIl07XG4gICAgICB9XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHNldExvYWRpbmcoZmFsc2UpO1xuICAgICAgYXV0aENoZWNrSW5Qcm9ncmVzcy5jdXJyZW50ID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH07XG5cbiAgLy8gQ2hlY2sgaWYgdXNlciBoYXMgc3BlY2lmaWVkIHBlcm1pc3Npb25cbiAgY29uc3QgaGFzUGVybWlzc2lvbiA9IChwZXJtaXNzaW9uKSA9PiB7XG4gICAgaWYgKCF1c2VyKSByZXR1cm4gZmFsc2U7XG5cbiAgICAvLyBBZG1pbnMgYW5kIHN1cGVyYWRtaW5zIGhhdmUgYWxsIHBlcm1pc3Npb25zXG4gICAgaWYgKFtcImFkbWluXCIsIFwic3VwZXJhZG1pblwiXS5pbmNsdWRlcyh1c2VyLnJvbGUpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdXNlci5wZXJtaXNzaW9ucyAmJiB1c2VyLnBlcm1pc3Npb25zLmluY2x1ZGVzKHBlcm1pc3Npb24pO1xuICB9O1xuXG4gIHJldHVybiAoXG4gICAgPEF1dGhDb250ZXh0LlByb3ZpZGVyXG4gICAgICB2YWx1ZT17e1xuICAgICAgICB1c2VyLFxuICAgICAgICBsb2FkaW5nLFxuICAgICAgICBlcnJvcixcbiAgICAgICAgcmVnaXN0ZXIsXG4gICAgICAgIGxvZ2luLFxuICAgICAgICBsb2dvdXQsXG4gICAgICAgIGhhc1Blcm1pc3Npb24sXG4gICAgICAgIGNoZWNrVXNlckxvZ2dlZEluLFxuICAgICAgfX1cbiAgICA+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9BdXRoQ29udGV4dC5Qcm92aWRlcj5cbiAgKTtcbn07XG5cbi8vIEV4cG9ydCB0aGUgdXNlQXV0aCBob29rXG5leHBvcnQgY29uc3QgdXNlQXV0aCA9ICgpID0+IHtcbiAgY29uc3QgY29udGV4dCA9IHVzZUNvbnRleHQoQXV0aENvbnRleHQpO1xuICBpZiAoY29udGV4dCA9PT0gdW5kZWZpbmVkIHx8IGNvbnRleHQgPT09IG51bGwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1c2VBdXRoIG11c3QgYmUgdXNlZCB3aXRoaW4gYW4gQXV0aFByb3ZpZGVyXCIpO1xuICB9XG4gIHJldHVybiBjb250ZXh0O1xufTtcbiJdLCJuYW1lcyI6WyJjcmVhdGVDb250ZXh0IiwidXNlU3RhdGUiLCJ1c2VFZmZlY3QiLCJ1c2VDb250ZXh0IiwidXNlUmVmIiwidXNlUm91dGVyIiwiYXhpb3MiLCJzZXRDb29raWUiLCJnZXRDb29raWUiLCJkZWxldGVDb29raWUiLCJBdXRoQ29udGV4dCIsInNldHVwQXhpb3NEZWZhdWx0cyIsInRva2VuIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwiQXV0aFByb3ZpZGVyIiwiY2hpbGRyZW4iLCJ1c2VyIiwic2V0VXNlciIsImxvYWRpbmciLCJzZXRMb2FkaW5nIiwiZXJyb3IiLCJzZXRFcnJvciIsInRva2VuUmVmcmVzaEludGVydmFsIiwic2V0VG9rZW5SZWZyZXNoSW50ZXJ2YWwiLCJhdXRoQ2hlY2tJblByb2dyZXNzIiwiaGFzSW5pdGlhbGl6ZWQiLCJyb3V0ZXIiLCJpbml0QXV0aCIsImN1cnJlbnQiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiY2hlY2tVc2VyTG9nZ2VkSW4iLCJjbGVhckludGVydmFsIiwic2V0dXBUb2tlblJlZnJlc2giLCJpbnRlcnZhbCIsInNldEludGVydmFsIiwicmVmcmVzaFJlcyIsImdldCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19BUElfVVJMIiwiQXV0aG9yaXphdGlvbiIsImRhdGEiLCJzdWNjZXNzIiwiY29uc29sZSIsImxvZ291dCIsInJlZ2lzdGVyIiwidXNlckRhdGEiLCJyZXMiLCJwb3N0Iiwid2l0aENyZWRlbnRpYWxzIiwicHVzaCIsInJlc3BvbnNlIiwic2V0VGltZW91dCIsImxvZ2luIiwiZW1haWwiLCJwYXNzd29yZCIsImxvZyIsInBhdGgiLCJyZW1vdmVJdGVtIiwicmVxdWlyZVR3b0ZhY3RvciIsInBhdGhuYW1lIiwicXVlcnkiLCJ0cmltIiwic2V0SXRlbSIsIm1heEFnZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhyZWYiLCJpc0xvZ2dpbmdPdXQiLCJmZXRjaCIsIm1ldGhvZCIsInRoZW4iLCJjYXRjaCIsImUiLCJhcGlFcnJvciIsInRpbWVzdGFtcCIsIkRhdGUiLCJub3ciLCJsb2dpblVybCIsIm9yaWdpbiIsInJlcGxhY2UiLCJjb29raWVUb2tlbiIsImxvY2FsVG9rZW4iLCJjYWNoZWRVc2VyIiwicGFyc2UiLCJzdGF0dXMiLCJoYXNQZXJtaXNzaW9uIiwicGVybWlzc2lvbiIsImluY2x1ZGVzIiwicm9sZSIsInBlcm1pc3Npb25zIiwiUHJvdmlkZXIiLCJ2YWx1ZSIsInVzZUF1dGgiLCJjb250ZXh0IiwidW5kZWZpbmVkIiwiRXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/context/AuthContext.js\n"));

/***/ })

});